I"Ü£<h2 id="topics">Topics</h2>
<ul>
  <li>Merging data frames</li>
  <li>Selecting columns from data frames</li>
  <li>Selecting rows from data frames</li>
  <li>Connecting steps in data processing with pipes</li>
  <li>Boolean operations</li>
</ul>

<h2 id="joining-metadata-and-pcoa">Joining <code class="language-plaintext highlighter-rouge">metadata</code> and <code class="language-plaintext highlighter-rouge">pcoa</code></h2>
<p>If we compile all of the code in the last lesson, we now have this code chunk which is a more sophisticated version of the original code chunk that we created in the first lesson.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">library</span><span class="p">(</span><span class="n">tidyverse</span><span class="p">)</span><span class="w">
</span><span class="n">library</span><span class="p">(</span><span class="n">readxl</span><span class="p">)</span><span class="w">

</span><span class="n">pcoa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.braycurtis.pcoa.axes"</span><span class="p">,</span><span class="w">
		</span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">col_character</span><span class="p">())</span><span class="w">
	</span><span class="p">)</span><span class="w">

</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_excel</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s2">"raw_data/baxter.metadata.xlsx"</span><span class="p">,</span><span class="w">
		</span><span class="n">col_types</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="n">sample</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">fit_result</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="n">Site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">Dx_Bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w">
				</span><span class="n">dx</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">Hx_Prev</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w"> </span><span class="n">Hx_of_Polyps</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w"> </span><span class="n">Age</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w">
				</span><span class="n">Gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">,</span><span class="w"> </span><span class="n">Smoke</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w"> </span><span class="n">Diabetic</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w"> </span><span class="n">Hx_Fam_CRC</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w">
				</span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="n">Weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"numeric"</span><span class="p">,</span><span class="w"> </span><span class="n">NSAID</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w"> </span><span class="n">Diabetes_Med</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"logical"</span><span class="p">,</span><span class="w">
				</span><span class="n">stage</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">"text"</span><span class="p">)</span><span class="w">
	</span><span class="p">)</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">Height</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na_if</span><span class="p">(</span><span class="n">Height</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">Weight</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">na_if</span><span class="p">(</span><span class="n">Weight</span><span class="p">,</span><span class="w"> </span><span class="m">0</span><span class="p">))</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">Site</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">.x</span><span class="o">=</span><span class="n">Site</span><span class="p">,</span><span class="w"> </span><span class="s2">"U of Michigan"</span><span class="o">=</span><span class="s2">"U Michigan"</span><span class="p">))</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">Dx_Bin</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">.x</span><span class="o">=</span><span class="n">Dx_Bin</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cancer."</span><span class="o">=</span><span class="s2">"Cancer"</span><span class="p">))</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">Gender</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">recode</span><span class="p">(</span><span class="n">.x</span><span class="o">=</span><span class="n">Gender</span><span class="p">,</span><span class="w"> </span><span class="s2">"f"</span><span class="o">=</span><span class="s2">"female"</span><span class="p">,</span><span class="w"> </span><span class="s2">"m"</span><span class="o">=</span><span class="s2">"male"</span><span class="p">))</span><span class="w">

</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rename_all</span><span class="p">(</span><span class="n">.tbl</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">.funs</span><span class="o">=</span><span class="n">tolower</span><span class="p">)</span><span class="w">
</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">rename</span><span class="p">(</span><span class="n">.data</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span><span class="w">
		</span><span class="n">previous_history</span><span class="o">=</span><span class="n">hx_prev</span><span class="p">,</span><span class="w">
		</span><span class="n">history_of_polyps</span><span class="o">=</span><span class="n">hx_of_polyps</span><span class="p">,</span><span class="w">
		</span><span class="n">family_history_of_crc</span><span class="o">=</span><span class="n">hx_fam_crc</span><span class="p">,</span><span class="w">
		</span><span class="n">diagnosis_bin</span><span class="o">=</span><span class="n">dx_bin</span><span class="p">,</span><span class="w">
		</span><span class="n">diagnosis</span><span class="o">=</span><span class="n">dx</span><span class="p">,</span><span class="w">
		</span><span class="n">sex</span><span class="o">=</span><span class="n">gender</span><span class="p">)</span><span class="w">

</span><span class="n">metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">mutate</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">factor</span><span class="p">(</span><span class="n">diagnosis</span><span class="p">,</span><span class="w"> </span><span class="n">levels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">)))</span><span class="w">

</span><span class="n">dir.create</span><span class="p">(</span><span class="s2">"processed_data"</span><span class="p">,</span><span class="w"> </span><span class="n">showWarnings</span><span class="o">=</span><span class="kc">FALSE</span><span class="p">)</span><span class="w">
</span><span class="n">write_tsv</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="o">=</span><span class="s1">'processed_data/baxter.metadata.tsv'</span><span class="p">)</span><span class="w">

</span><span class="n">metadata_pcoa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">pcoa</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'sample'</span><span class="o">=</span><span class="s1">'group'</span><span class="p">))</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">metadata_pcoa</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">axis1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">axis2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">diagnosis</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
		</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w">
		</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">),</span><span class="w">
		</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cancer"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"PCoA of Bray-Curtis Distances Between Stool Samples"</span><span class="p">,</span><span class="w">
		</span><span class="n">x</span><span class="o">=</span><span class="s2">"PCo Axis 1"</span><span class="p">,</span><span class="w">
		</span><span class="n">y</span><span class="o">=</span><span class="s2">"PCo Axis 2"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p>We‚Äôve almost accounted for all of the lines in this code chunk. One thing we haven‚Äôt accounted for yet is the <code class="language-plaintext highlighter-rouge">inner_join</code> function, which was called after cleaning up the <code class="language-plaintext highlighter-rouge">metadata</code> data frame and before using <code class="language-plaintext highlighter-rouge">ggplot</code> to plot the data. The syntax here should be somewhat clear. The function ‚Äújoins‚Äù two data frames - <code class="language-plaintext highlighter-rouge">pcoa</code> and <code class="language-plaintext highlighter-rouge">metadata</code> - based on the columns ‚Äúsample‚Äù and ‚Äúgroup‚Äù, which are the columns in the <code class="language-plaintext highlighter-rouge">metadata</code> and <code class="language-plaintext highlighter-rouge">pcoa</code> data frames, respectively. If we were thinking ahead, we could have renamed the ‚Äúgroup‚Äù column in <code class="language-plaintext highlighter-rouge">pcoa</code> to be ‚Äúsample‚Äù and then the command could have just been <code class="language-plaintext highlighter-rouge">inner_join(metadata, pcoa)</code>. When you look at the contents of the <code class="language-plaintext highlighter-rouge">metadata_pcoa</code> data frame you‚Äôll see that the data frame is now 490 rows by 507 columns. Perhaps you‚Äôre wondering what the <strong><em>inner</em></strong> in the <code class="language-plaintext highlighter-rouge">inner_join</code> function is about. It turns out that the <code class="language-plaintext highlighter-rouge">dplyr</code> package has several ways to join data frames. As we‚Äôll see, the <code class="language-plaintext highlighter-rouge">inner_join</code> function joins two data frames based on a column that they have in common (i.e. <code class="language-plaintext highlighter-rouge">by=c('sample'='group')</code> in our case) and if a sample or group is missing from one of the data frames, it is excluded from the joined data frame. This is what is called an ‚Äú<a href="https://en.wikipedia.org/wiki/Join_(SQL)#Inner_join">inner join</a>‚Äù.</p>

<h2 id="joins">Joins</h2>
<p>In addition to an ‚Äúinner join‚Äù, the <code class="language-plaintext highlighter-rouge">dplyr</code> package has ‚Äú<a href="https://en.wikipedia.org/wiki/Join_(SQL)#Left_outer_join">left join</a>‚Äù (i.e. <code class="language-plaintext highlighter-rouge">left_join</code>) and ‚Äú<a href="https://en.wikipedia.org/wiki/Join_(SQL)#Right_outer_join">right join</a>‚Äù (i.e. <code class="language-plaintext highlighter-rouge">right_join</code>) functions, which will merge the data frames using the sample identifiers found in the left or right data frame being joined. There is also a ‚Äú<a href="https://en.wikipedia.org/wiki/Join_(SQL)#Full_outer_join">full join</a>‚Äù (i.e. <code class="language-plaintext highlighter-rouge">full_join</code>), which produces a data frame where the samples from both data frames are represented even if they‚Äôre missing from one of the data frames. Let‚Äôs do a couple of examples to demonstrate these joins. To keep things simple, we‚Äôll define two new data frames. We can do this by giving the <code class="language-plaintext highlighter-rouge">tibble</code> function a series of vectors that will be used to create the columns</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">a</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"C"</span><span class="p">),</span><span class="w"> </span><span class="n">diagnosis</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">))</span><span class="w">
</span><span class="n">a</span><span class="w">

</span><span class="n">b</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">sample</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"D"</span><span class="p">),</span><span class="w"> </span><span class="n">previous_history</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="nb">T</span><span class="p">))</span><span class="w">
</span><span class="n">b</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 3 x 2
##   sample diagnosis
##   &lt;chr&gt;  &lt;chr&gt;    
## 1 A      normal   
## 2 B      cancer   
## 3 C      adenoma  
## # A tibble: 3 x 2
##   sample previous_history
##   &lt;chr&gt;  &lt;lgl&gt;           
## 1 A      TRUE            
## 2 B      FALSE           
## 3 D      TRUE
</code></pre></div></div>

<p>We‚Äôll do a ‚Äúleft join‚Äù ‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">left_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 3 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE           
## 3 C      adenoma   NA
</code></pre></div></div>

<p>Notice that because <code class="language-plaintext highlighter-rouge">b</code> doesn‚Äôt have a value for ‚ÄúC‚Äù in column ‚Äúsample‚Äù, the resulting data frame has a <code class="language-plaintext highlighter-rouge">NA</code> in that cell. Because <code class="language-plaintext highlighter-rouge">a</code> doesn‚Äôt have a value for ‚ÄúD‚Äù in column ‚Äúsample‚Äù it is excluded from the new data frame. If we instead do a ‚Äúright join‚Äù ‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">right_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 3 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE           
## 3 D      &lt;NA&gt;      TRUE
</code></pre></div></div>

<p>We see the opposite result - sample ‚ÄúC‚Äù is missing in the new data frame and the value in column ‚Äúdiagnosis‚Äù for sample ‚ÄúD‚Äù is <code class="language-plaintext highlighter-rouge">NA</code>. If we now do a ‚Äúfull join‚Äù‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">full_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 4 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE           
## 3 C      adenoma   NA              
## 4 D      &lt;NA&gt;      TRUE
</code></pre></div></div>

<p>Here we see that all four samples are represented, but that the ‚Äúdiagnosis‚Äù and ‚Äúprevious_history‚Äù columns have <code class="language-plaintext highlighter-rouge">NA</code> values for samples D and C, respectively. Finally, returning to our old friend, ‚Äúinner join‚Äù‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inner_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE
</code></pre></div></div>

<p>We now get a data frame that has two rows representing the two samples that were found in <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>. Depending on your goals, you will need to chose the appropriate join function. Most of the time I use an <code class="language-plaintext highlighter-rouge">inner_join</code> since I will only want the values (e.g. the axes in <code class="language-plaintext highlighter-rouge">pcoa</code>) that I have metadata for and I will only want the descriptors (e.g. the values in <code class="language-plaintext highlighter-rouge">metadata</code>) that I have community data for.</p>

<hr />

<h3 id="activity-1">Activity 1</h3>
<p>What happens in these cases when we reverse the <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> data frames in the <code class="language-plaintext highlighter-rouge">inner_join</code> function call?</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">left_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span><span class="n">right_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span><span class="n">full_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span><span class="n">inner_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 3 x 3
##   sample previous_history diagnosis
##   &lt;chr&gt;  &lt;lgl&gt;            &lt;chr&gt;    
## 1 A      TRUE             normal   
## 2 B      FALSE            cancer   
## 3 D      TRUE             &lt;NA&gt;     
## # A tibble: 3 x 3
##   sample previous_history diagnosis
##   &lt;chr&gt;  &lt;lgl&gt;            &lt;chr&gt;    
## 1 A      TRUE             normal   
## 2 B      FALSE            cancer   
## 3 C      NA               adenoma  
## # A tibble: 4 x 3
##   sample previous_history diagnosis
##   &lt;chr&gt;  &lt;lgl&gt;            &lt;chr&gt;    
## 1 A      TRUE             normal   
## 2 B      FALSE            cancer   
## 3 D      TRUE             &lt;NA&gt;     
## 4 C      NA               adenoma  
## # A tibble: 2 x 3
##   sample previous_history diagnosis
##   &lt;chr&gt;  &lt;lgl&gt;            &lt;chr&gt;    
## 1 A      TRUE             normal   
## 2 B      FALSE            cancer
</code></pre></div>  </div>

  <p>We see that the order of the columns is reversed</p>
</div>

<hr />

<h3 id="activity-2">Activity 2</h3>
<p>What happens if we leave out the <code class="language-plaintext highlighter-rouge">by="sample"</code> argument from our join commands?</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inner_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE
</code></pre></div>  </div>

  <p>The commands are smart enough to figure out that since there‚Äôs only one column name in common between the two data frames, then it should join using the ‚Äúsample‚Äù column.</p>
</div>

<hr />

<p>Perhaps we want to know whether there are any rows from our data frames that will be removed when we do an inner join. For this case, we can use the <code class="language-plaintext highlighter-rouge">anti_join</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">anti_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 1 x 2
##   sample diagnosis
##   &lt;chr&gt;  &lt;chr&gt;    
## 1 C      adenoma
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">anti_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 1 x 2
##   sample previous_history
##   &lt;chr&gt;  &lt;lgl&gt;           
## 1 D      TRUE
</code></pre></div></div>

<p>We can see that for the first case, the row for sample ‚ÄúC‚Äù is found in <code class="language-plaintext highlighter-rouge">a</code>, but not <code class="language-plaintext highlighter-rouge">b</code>. In the second case, sample ‚ÄúD‚Äù is found in <code class="language-plaintext highlighter-rouge">b</code>, but not <code class="language-plaintext highlighter-rouge">a</code>.</p>

<p>We can also see what from <code class="language-plaintext highlighter-rouge">a</code> overlaps with <code class="language-plaintext highlighter-rouge">b</code> and vice versa with the <code class="language-plaintext highlighter-rouge">semi_join</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">semi_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 2
##   sample diagnosis
##   &lt;chr&gt;  &lt;chr&gt;    
## 1 A      normal   
## 2 B      cancer
</code></pre></div></div>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">semi_join</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="w"> </span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 2
##   sample previous_history
##   &lt;chr&gt;  &lt;lgl&gt;           
## 1 A      TRUE            
## 2 B      FALSE
</code></pre></div></div>

<p>One last thing to comment on is that our simple examples of joining <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code> have been using <code class="language-plaintext highlighter-rouge">by="sample"</code> in all of the examples. If you look at the syntax of the command we used when building our ordination plot, the syntax was <code class="language-plaintext highlighter-rouge">by=c('sample'='group')</code>. This is because <code class="language-plaintext highlighter-rouge">sample</code> is a column shared by both <code class="language-plaintext highlighter-rouge">a</code> and <code class="language-plaintext highlighter-rouge">b</code>, while <code class="language-plaintext highlighter-rouge">sample</code> and <code class="language-plaintext highlighter-rouge">group</code> are columns that contain the same information (i.e. the subject‚Äôs id number). Let‚Äôs illustrate this with a new data frame, <code class="language-plaintext highlighter-rouge">c</code>, which has a column <code class="language-plaintext highlighter-rouge">group</code> instead of <code class="language-plaintext highlighter-rouge">sample</code>:</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">c</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">tibble</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"A"</span><span class="p">,</span><span class="w"> </span><span class="s2">"B"</span><span class="p">,</span><span class="w"> </span><span class="s2">"D"</span><span class="p">),</span><span class="w"> </span><span class="n">previous_history</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="nb">T</span><span class="p">,</span><span class="w"> </span><span class="nb">F</span><span class="p">,</span><span class="w"> </span><span class="nb">T</span><span class="p">))</span><span class="w">
</span><span class="n">c</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 3 x 2
##   group previous_history
##   &lt;chr&gt; &lt;lgl&gt;           
## 1 A     TRUE            
## 2 B     FALSE           
## 3 D     TRUE
</code></pre></div></div>

<p>If we do our <code class="language-plaintext highlighter-rouge">inner_join</code> as before, we‚Äôll get an error‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inner_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="s2">"sample"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## Error: Join columns must be present in data.
## ‚úñ Problem with `sample`.
</code></pre></div></div>

<p>See that? It tells us that the join columns must be present in data and that there‚Äôs a problem wiht using ‚Äúsample‚Äù to join the data frames. To resolve this, we need to use the syntax we saw earlier. We can replace <code class="language-plaintext highlighter-rouge">by="sample"</code> with <code class="language-plaintext highlighter-rouge">by=c('sample'='group')</code>. This effectively tells <code class="language-plaintext highlighter-rouge">inner_join</code> to join the two data frames using the <code class="language-plaintext highlighter-rouge">sample</code> column from data frame <code class="language-plaintext highlighter-rouge">a</code> and the <code class="language-plaintext highlighter-rouge">group</code> column from data frame <code class="language-plaintext highlighter-rouge">b</code>.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">inner_join</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="w"> </span><span class="n">c</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'sample'</span><span class="o">=</span><span class="s1">'group'</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 3
##   sample diagnosis previous_history
##   &lt;chr&gt;  &lt;chr&gt;     &lt;lgl&gt;           
## 1 A      normal    TRUE            
## 2 B      cancer    FALSE
</code></pre></div></div>

<h2 id="selecting-columns-from-our-data-frames">Selecting columns from our data frames</h2>
<p>Looking at the ordination data that is in our <code class="language-plaintext highlighter-rouge">pcoa</code> data frame, we see that there were a few hundred columns. When this is joined to the <code class="language-plaintext highlighter-rouge">metadata</code> data frame we get a very wide and obnoxiously large data frame. We really only need the first four columns of the <code class="language-plaintext highlighter-rouge">pcoa</code> data frame (i.e. ‚Äúgroup‚Äù, ‚Äúaxis1‚Äù, ‚Äúaxis2‚Äù, and ‚Äúaxis3‚Äù). We can do this with the <code class="language-plaintext highlighter-rouge">select</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">pcoa</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">axis1</span><span class="p">,</span><span class="w"> </span><span class="n">axis2</span><span class="p">,</span><span class="w"> </span><span class="n">axis3</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 4
##    group    axis1    axis2   axis3
##    &lt;chr&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 2003650  0.281 -0.0575  -0.0517
##  2 2005650  0.309  0.00522 -0.0664
##  3 2007660  0.154  0.0622  -0.0178
##  4 2009650  0.293 -0.0153   0.0703
##  5 2013660 -0.223 -0.137   -0.0403
##  6 2015650  0.280  0.00598 -0.187 
##  7 2017660  0.111 -0.0704   0.110 
##  8 2019651  0.107 -0.224    0.0411
##  9 2023680  0.260  0.0965  -0.0790
## 10 2025653 -0.144 -0.169    0.0271
## # ‚Ä¶ with 480 more rows
</code></pre></div></div>

<p>The resulting tibble still has 490 rows, but now it has the 4 columns we <em>selected</em>. If we want to remove specific columns we could also use a negative sign</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">pcoa</span><span class="p">,</span><span class="w"> </span><span class="o">-</span><span class="n">axis1</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 490
##    group    axis2   axis3   axis4    axis5    axis6    axis7    axis8   axis9
##    &lt;chr&gt;    &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;
##  1 2003‚Ä¶ -0.0575  -0.0517 -0.0901  0.00955 -0.0599  -0.0529  -0.0391   0.0263
##  2 2005‚Ä¶  0.00522 -0.0664  0.0715 -0.00733 -0.0449   0.0400  -0.0223  -0.0268
##  3 2007‚Ä¶  0.0622  -0.0178  0.0953 -0.122   -0.0935   0.00763  0.0370  -0.0398
##  4 2009‚Ä¶ -0.0153   0.0703  0.0351 -0.0176  -0.00318  0.0437  -0.0827  -0.0478
##  5 2013‚Ä¶ -0.137   -0.0403  0.0344 -0.0115  -0.0400   0.107    0.233    0.0274
##  6 2015‚Ä¶  0.00598 -0.187  -0.0383  0.0653  -0.131   -0.164    0.0603   0.0522
##  7 2017‚Ä¶ -0.0704   0.110  -0.104   0.0389   0.0439   0.0993   0.0709  -0.0981
##  8 2019‚Ä¶ -0.224    0.0411 -0.103  -0.00765  0.0902  -0.107    0.00435  0.0413
##  9 2023‚Ä¶  0.0965  -0.0790  0.0406 -0.0554  -0.108   -0.0646  -0.0755  -0.0423
## 10 2025‚Ä¶ -0.169    0.0271  0.108  -0.0600  -0.109    0.0316  -0.0612  -0.166 
## # ‚Ä¶ with 480 more rows, and 481 more variables: axis10 &lt;dbl&gt;, axis11 &lt;dbl&gt;,
## #   axis12 &lt;dbl&gt;, axis13 &lt;dbl&gt;, axis14 &lt;dbl&gt;, axis15 &lt;dbl&gt;, axis16 &lt;dbl&gt;,
## #   axis17 &lt;dbl&gt;, axis18 &lt;dbl&gt;, axis19 &lt;dbl&gt;, axis20 &lt;dbl&gt;, axis21 &lt;dbl&gt;,
## #   axis22 &lt;dbl&gt;, axis23 &lt;dbl&gt;, axis24 &lt;dbl&gt;, axis25 &lt;dbl&gt;, axis26 &lt;dbl&gt;,
## #   axis27 &lt;dbl&gt;, axis28 &lt;dbl&gt;, axis29 &lt;dbl&gt;, axis30 &lt;dbl&gt;, axis31 &lt;dbl&gt;,
## #   axis32 &lt;dbl&gt;, axis33 &lt;dbl&gt;, axis34 &lt;dbl&gt;, axis35 &lt;dbl&gt;, axis36 &lt;dbl&gt;,
## #   axis37 &lt;dbl&gt;, axis38 &lt;dbl&gt;, axis39 &lt;dbl&gt;, axis40 &lt;dbl&gt;, axis41 &lt;dbl&gt;,
## #   axis42 &lt;dbl&gt;, axis43 &lt;dbl&gt;, axis44 &lt;dbl&gt;, axis45 &lt;dbl&gt;, axis46 &lt;dbl&gt;,
## #   axis47 &lt;dbl&gt;, axis48 &lt;dbl&gt;, axis49 &lt;dbl&gt;, axis50 &lt;dbl&gt;, axis51 &lt;dbl&gt;,
## #   axis52 &lt;dbl&gt;, axis53 &lt;dbl&gt;, axis54 &lt;dbl&gt;, axis55 &lt;dbl&gt;, axis56 &lt;dbl&gt;,
## #   axis57 &lt;dbl&gt;, axis58 &lt;dbl&gt;, axis59 &lt;dbl&gt;, axis60 &lt;dbl&gt;, axis61 &lt;dbl&gt;,
## #   axis62 &lt;dbl&gt;, axis63 &lt;dbl&gt;, axis64 &lt;dbl&gt;, axis65 &lt;dbl&gt;, axis66 &lt;dbl&gt;,
## #   axis67 &lt;dbl&gt;, axis68 &lt;dbl&gt;, axis69 &lt;dbl&gt;, axis70 &lt;dbl&gt;, axis71 &lt;dbl&gt;,
## #   axis72 &lt;dbl&gt;, axis73 &lt;dbl&gt;, axis74 &lt;dbl&gt;, axis75 &lt;dbl&gt;, axis76 &lt;dbl&gt;,
## #   axis77 &lt;dbl&gt;, axis78 &lt;dbl&gt;, axis79 &lt;dbl&gt;, axis80 &lt;dbl&gt;, axis81 &lt;dbl&gt;,
## #   axis82 &lt;dbl&gt;, axis83 &lt;dbl&gt;, axis84 &lt;dbl&gt;, axis85 &lt;dbl&gt;, axis86 &lt;dbl&gt;,
## #   axis87 &lt;dbl&gt;, axis88 &lt;dbl&gt;, axis89 &lt;dbl&gt;, axis90 &lt;dbl&gt;, axis91 &lt;dbl&gt;,
## #   axis92 &lt;dbl&gt;, axis93 &lt;dbl&gt;, axis94 &lt;dbl&gt;, axis95 &lt;dbl&gt;, axis96 &lt;dbl&gt;,
## #   axis97 &lt;dbl&gt;, axis98 &lt;dbl&gt;, axis99 &lt;dbl&gt;, axis100 &lt;dbl&gt;, axis101 &lt;dbl&gt;,
## #   axis102 &lt;dbl&gt;, axis103 &lt;dbl&gt;, axis104 &lt;dbl&gt;, axis105 &lt;dbl&gt;, axis106 &lt;dbl&gt;,
## #   axis107 &lt;dbl&gt;, axis108 &lt;dbl&gt;, axis109 &lt;dbl&gt;, ‚Ä¶
</code></pre></div></div>

<p>The result is that the ‚Äúaxis1‚Äù column has been removed. If we consider our <code class="language-plaintext highlighter-rouge">metadata</code> data frame, we could also select the sample column any column that starts with ‚Äúdiagnosis‚Äù</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">starts_with</span><span class="p">(</span><span class="s2">"diagnosis"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 3
##    sample  diagnosis_bin    diagnosis
##    &lt;chr&gt;   &lt;chr&gt;            &lt;fct&gt;    
##  1 2003650 High Risk Normal normal   
##  2 2005650 High Risk Normal normal   
##  3 2007660 High Risk Normal normal   
##  4 2009650 Adenoma          adenoma  
##  5 2013660 Normal           normal   
##  6 2015650 High Risk Normal normal   
##  7 2017660 Cancer           cancer   
##  8 2019651 Normal           normal   
##  9 2023680 High Risk Normal normal   
## 10 2025653 Cancer           cancer   
## # ‚Ä¶ with 480 more rows
</code></pre></div></div>

<p>This gets us a new data frame with the columns ‚Äúsample‚Äù, ‚Äúdiagnosis_bin‚Äù, and ‚Äúdiagnosis‚Äù. We could also get the ‚Äúsample‚Äù column and any column that contains ‚Äúhistory‚Äù</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">select</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">sample</span><span class="p">,</span><span class="w"> </span><span class="n">contains</span><span class="p">(</span><span class="s2">"history"</span><span class="p">))</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 4
##    sample  previous_history history_of_polyps family_history_of_crc
##    &lt;chr&gt;   &lt;lgl&gt;            &lt;lgl&gt;             &lt;lgl&gt;                
##  1 2003650 FALSE            TRUE              TRUE                 
##  2 2005650 FALSE            TRUE              FALSE                
##  3 2007660 FALSE            TRUE              TRUE                 
##  4 2009650 FALSE            TRUE              FALSE                
##  5 2013660 FALSE            FALSE             FALSE                
##  6 2015650 FALSE            TRUE              FALSE                
##  7 2017660 TRUE             TRUE              FALSE                
##  8 2019651 FALSE            FALSE             FALSE                
##  9 2023680 TRUE             TRUE              FALSE                
## 10 2025653 TRUE             TRUE              FALSE                
## # ‚Ä¶ with 480 more rows
</code></pre></div></div>

<p>This generates a data frame that contains the columns ‚Äúsample‚Äù, ‚Äúprevious_history‚Äù, ‚Äúhistory_of_polyps‚Äù, and ‚Äúfamily_history_of_crc‚Äù. There are other helper functions including <code class="language-plaintext highlighter-rouge">ends_with</code>, <code class="language-plaintext highlighter-rouge">matches</code>, <code class="language-plaintext highlighter-rouge">num_range</code>, and <code class="language-plaintext highlighter-rouge">one_of</code> that you can learn more about by using the <code class="language-plaintext highlighter-rouge">?</code> helper.</p>

<h2 id="selecting-rows-from-our-data-frames">Selecting rows from our data frames</h2>
<p>We might also want to make new data frames that contain a subset of the rows. We can ‚Äúfilter‚Äù the data frame using the <code class="language-plaintext highlighter-rouge">filter</code> function from the <code class="language-plaintext highlighter-rouge">dplyr</code> package. Let‚Äôs assume that we want to recreate our favorite ordination using only samples from the University of Michigan. We can generate a new data frame using <code class="language-plaintext highlighter-rouge">filter</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">site</span><span class="o">==</span><span class="s2">"U Michigan"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 107 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20036‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20056‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  3 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  4 20136‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  5 20196‚Ä¶         19 U Mi‚Ä¶ Normal        normal    FALSE           
##  6 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  7 20296‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  8 20416‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  9 20456‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
## 10 20576‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
## # ‚Ä¶ with 97 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>The resulting data frame has 107 samples. You‚Äôll notice that I used <code class="language-plaintext highlighter-rouge">site=="U Michigan"</code>. This tells <code class="language-plaintext highlighter-rouge">filter</code> to identify those rows where the ‚Äúsite‚Äù column had a value equal to ‚ÄúU Michigan‚Äù. The <code class="language-plaintext highlighter-rouge">==</code> is a logical comparison that asks whether the value on either side of the <code class="language-plaintext highlighter-rouge">==</code> are the same. The answer is either <code class="language-plaintext highlighter-rouge">TRUE</code> or <code class="language-plaintext highlighter-rouge">FALSE</code>. There are other logical operators that you should already be familiar with (but perhaps didn‚Äôt know!) including <code class="language-plaintext highlighter-rouge">&lt;</code>, <code class="language-plaintext highlighter-rouge">&lt;=</code>, <code class="language-plaintext highlighter-rouge">&gt;</code>, <code class="language-plaintext highlighter-rouge">&gt;=</code>. These should be self explanatory. The fit result measures how much blood is in a person‚Äôs stool. It‚Äôs a common non-invasive diagnostic to identify colonic lesions and a value greater than 100 is a concern. If we want ever subject that has a <code class="language-plaintext highlighter-rouge">fit_result</code> greater than or equal to 100 we would write</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">fit_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 126 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  2 20936‚Ä¶        286 Dana‚Ä¶ Normal        normal    TRUE            
##  3 21056‚Ä¶        314 U Mi‚Ä¶ Normal        normal    FALSE           
##  4 21856‚Ä¶        982 Toro‚Ä¶ Adv Adenoma   adenoma   FALSE           
##  5 21876‚Ä¶       1200 Toro‚Ä¶ Cancer        cancer    FALSE           
##  6 22036‚Ä¶       1992 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  7 22556‚Ä¶        140 Dana‚Ä¶ Cancer        cancer    TRUE            
##  8 22676‚Ä¶        149 Dana‚Ä¶ Cancer        cancer    TRUE            
##  9 22836‚Ä¶       1346 Toro‚Ä¶ Cancer        cancer    FALSE           
## 10 22876‚Ä¶        939 Dana‚Ä¶ Cancer        cancer    TRUE            
## # ‚Ä¶ with 116 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>Some of our columns are already logical. To get those individuals with a previous history of colorectal cancer we could do</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">previous_history</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 138 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  2 20236‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  3 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  4 20336‚Ä¶          0 Toro‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  5 20516‚Ä¶          0 Dana‚Ä¶ Adenoma       adenoma   TRUE            
##  6 20556‚Ä¶          0 Dana‚Ä¶ Adv Adenoma   adenoma   TRUE            
##  7 20636‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  8 20876‚Ä¶          5 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  9 20936‚Ä¶        286 Dana‚Ä¶ Normal        normal    TRUE            
## 10 21096‚Ä¶          0 Dana‚Ä¶ Normal        normal    TRUE            
## # ‚Ä¶ with 128 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>If we want those samples from people <strong><em>without</em></strong> a previous history we can use the <code class="language-plaintext highlighter-rouge">!</code> operator which turns <code class="language-plaintext highlighter-rouge">TRUE</code> to <code class="language-plaintext highlighter-rouge">FALSE</code> and <code class="language-plaintext highlighter-rouge">FALSE</code> to <code class="language-plaintext highlighter-rouge">TRUE</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="o">!</span><span class="n">previous_history</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 349 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20036‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20056‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  3 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  4 20096‚Ä¶         10 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  5 20136‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  6 20156‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  7 20196‚Ä¶         19 U Mi‚Ä¶ Normal        normal    FALSE           
##  8 20276‚Ä¶          0 Toro‚Ä¶ Normal        normal    FALSE           
##  9 20296‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
## 10 20316‚Ä¶          0 Toro‚Ä¶ Adenoma       adenoma   FALSE           
## # ‚Ä¶ with 339 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>The <code class="language-plaintext highlighter-rouge">!</code> can also be used as <code class="language-plaintext highlighter-rouge">!=</code> to test whether two values are different from each other. We could use this to get the samples from people that do not have a normal diagnosis</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s1">'normal'</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 318 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20096‚Ä¶         10 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  2 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  3 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  4 20296‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  5 20316‚Ä¶          0 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  6 20356‚Ä¶          0 Toro‚Ä¶ Adv Adenoma   adenoma   FALSE           
##  7 20376‚Ä¶         72 Toro‚Ä¶ Cancer        cancer    FALSE           
##  8 20416‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  9 20496‚Ä¶          0 Dana‚Ä¶ Adenoma       adenoma   FALSE           
## 10 20516‚Ä¶          0 Dana‚Ä¶ Adenoma       adenoma   TRUE            
## # ‚Ä¶ with 308 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<hr />

<h3 id="activity-3">Activity 3</h3>
<p>A common bug for novice and experienced programmers is shown below</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>filter(metadata, diagnosis="cancer")
</code></pre></div></div>

<p>Can you see what the problem is and how to fix it?</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">diagnosis</span><span class="o">==</span><span class="s2">"cancer"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 120 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  2 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  3 20376‚Ä¶         72 Toro‚Ä¶ Cancer        cancer    FALSE           
##  4 21876‚Ä¶       1200 Toro‚Ä¶ Cancer        cancer    FALSE           
##  5 22036‚Ä¶       1992 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  6 22556‚Ä¶        140 Dana‚Ä¶ Cancer        cancer    TRUE            
##  7 22676‚Ä¶        149 Dana‚Ä¶ Cancer        cancer    TRUE            
##  8 22836‚Ä¶       1346 Toro‚Ä¶ Cancer        cancer    FALSE           
##  9 22856‚Ä¶          0 U Mi‚Ä¶ Cancer        cancer    FALSE           
## 10 22876‚Ä¶        939 Dana‚Ä¶ Cancer        cancer    TRUE            
## # ‚Ä¶ with 110 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div>  </div>
</div>

<hr />

<h3 id="activity-4">Activity 4</h3>
<p>Create a data frame that contains only females</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">sex</span><span class="o">==</span><span class="s2">"female"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 243 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20096‚Ä¶         10 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  3 20136‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  4 20156‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  5 20236‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  6 20276‚Ä¶          0 Toro‚Ä¶ Normal        normal    FALSE           
##  7 20316‚Ä¶          0 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  8 20376‚Ä¶         72 Toro‚Ä¶ Cancer        cancer    FALSE           
##  9 20396‚Ä¶          0 Toro‚Ä¶ Normal        normal    FALSE           
## 10 20456‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
## # ‚Ä¶ with 233 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div>  </div>
</div>

<hr />

<h3 id="activity-5">Activity 5</h3>
<p>Create a data frame that contains individuals are 50 years old and younger</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">50</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 96 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20136‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  3 20616‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  4 20736‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  5 20776‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  6 20816‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  7 20836‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  8 20856‚Ä¶          7 Dana‚Ä¶ Normal        normal    FALSE           
##  9 20876‚Ä¶          5 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
## 10 20936‚Ä¶        286 Dana‚Ä¶ Normal        normal    TRUE            
## # ‚Ä¶ with 86 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div>  </div>
</div>

<hr />

<h3 id="activity-6">Activity 6</h3>

<p>Use the filter command to generate an ordination of samples from the University of Michigan.</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">um_metadata</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">site</span><span class="o">==</span><span class="s2">"U Michigan"</span><span class="p">)</span><span class="w">
</span><span class="n">um_metadata_pcoa</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">um_metadata</span><span class="p">,</span><span class="w"> </span><span class="n">pcoa</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'sample'</span><span class="o">=</span><span class="s1">'group'</span><span class="p">))</span><span class="w">

</span><span class="n">ggplot</span><span class="p">(</span><span class="n">um_metadata_pcoa</span><span class="p">,</span><span class="w"> </span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">axis1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">axis2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">diagnosis</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
		</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w">
		</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">),</span><span class="w">
		</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cancer"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"PCoA of Bray-Curtis Distances Between Stool Samples\nCollected at the University of Michigan"</span><span class="p">,</span><span class="w">
		</span><span class="n">x</span><span class="o">=</span><span class="s2">"PCo Axis 1"</span><span class="p">,</span><span class="w">
		</span><span class="n">y</span><span class="o">=</span><span class="s2">"PCo Axis 2"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
	</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="assets/images/04_combining_data_frames//unnamed-chunk-26-1.png" title="plot of chunk unnamed-chunk-26" alt="plot of chunk unnamed-chunk-26" width="504" /></p>
</div>

<hr />

<p>The <code class="language-plaintext highlighter-rouge">filter</code> and <code class="language-plaintext highlighter-rouge">select</code> functions are very powerful for subsetting our data frames. What if I want to get those samples from people that have a fit result over 100 and were given a normal diagnosis? We can use the <code class="language-plaintext highlighter-rouge">&amp;</code> operator to see if two logical comparisons are true</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">fit_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 5 x 17
##   sample fit_result site  diagnosis_bin diagnosis previous_history
##   &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
## 1 20936‚Ä¶        286 Dana‚Ä¶ Normal        normal    TRUE            
## 2 21056‚Ä¶        314 U Mi‚Ä¶ Normal        normal    FALSE           
## 3 23216‚Ä¶        148 Dana‚Ä¶ Normal        normal    FALSE           
## 4 30996‚Ä¶        356 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
## 5 31376‚Ä¶        118 U Mi‚Ä¶ Normal        normal    FALSE           
## # ‚Ä¶ with 11 more variables: history_of_polyps &lt;lgl&gt;, age &lt;dbl&gt;, sex &lt;chr&gt;,
## #   smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;, family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;,
## #   weight &lt;dbl&gt;, nsaid &lt;lgl&gt;, diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>If we want samples from people with a high fit result or a cancer diagnosis we can use a similar approach, except that instead of using <code class="language-plaintext highlighter-rouge">&amp;</code> we would use <code class="language-plaintext highlighter-rouge">|</code></p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">fit_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 156 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  2 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  3 20376‚Ä¶         72 Toro‚Ä¶ Cancer        cancer    FALSE           
##  4 20936‚Ä¶        286 Dana‚Ä¶ Normal        normal    TRUE            
##  5 21056‚Ä¶        314 U Mi‚Ä¶ Normal        normal    FALSE           
##  6 21856‚Ä¶        982 Toro‚Ä¶ Adv Adenoma   adenoma   FALSE           
##  7 21876‚Ä¶       1200 Toro‚Ä¶ Cancer        cancer    FALSE           
##  8 22036‚Ä¶       1992 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  9 22556‚Ä¶        140 Dana‚Ä¶ Cancer        cancer    TRUE            
## 10 22676‚Ä¶        149 Dana‚Ä¶ Cancer        cancer    TRUE            
## # ‚Ä¶ with 146 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div></div>

<p>We can make complicated filter commands easier to understand by grouping the logical questions with parentheses. Because <a href="https://en.wikipedia.org/wiki/Order_of_operations">algebra within parentheses is evaluated first</a>, we can control the order of operations for our question. For example, if we want the samples from women who have a high fit result or a cancer diagnosis we might be tempted do do‚Ä¶</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">fit_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"cancer"</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"female"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">count</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 2 x 2
##   sex        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 female    67
## 2 male      76
</code></pre></div></div>

<p>What happened? If you look through a table that lists the order of operations, you‚Äôll notice that the logical <code class="language-plaintext highlighter-rouge">AND</code> is perormed before the logical <code class="language-plaintext highlighter-rouge">OR</code>. Who remembers such things? To make our intention more clear and get the correct answer, we can wrap the <code class="language-plaintext highlighter-rouge">OR</code> statement in parentheses</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">fit_result</span><span class="w"> </span><span class="o">&gt;=</span><span class="w"> </span><span class="m">100</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">sex</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">"female"</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">count</span><span class="p">(</span><span class="n">sex</span><span class="p">)</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 1 x 2
##   sex        n
##   &lt;chr&gt;  &lt;int&gt;
## 1 female    67
</code></pre></div></div>

<hr />

<h3 id="activity-7">Activity 7</h3>
<p>Create a data frame that contains samples from individuals who are 50 years old and younger and have a non-normal diagnosis</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">age</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="m">50</span><span class="w"> </span><span class="o">&amp;</span><span class="w"> </span><span class="n">diagnosis</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="s2">"normal"</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 46 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 22036‚Ä¶       1992 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  2 23076‚Ä¶          0 Dana‚Ä¶ Adv Adenoma   adenoma   TRUE            
##  3 23396‚Ä¶       1278 Dana‚Ä¶ Cancer        cancer    TRUE            
##  4 23796‚Ä¶          0 Toro‚Ä¶ Adv Adenoma   adenoma   FALSE           
##  5 24216‚Ä¶        133 MD A‚Ä¶ Cancer        cancer    TRUE            
##  6 24636‚Ä¶         45 Dana‚Ä¶ Cancer        cancer    TRUE            
##  7 24656‚Ä¶       1185 Dana‚Ä¶ Cancer        cancer    TRUE            
##  8 25236‚Ä¶        392 MD A‚Ä¶ Cancer        cancer    TRUE            
##  9 25456‚Ä¶        301 Dana‚Ä¶ Adv Adenoma   adenoma   FALSE           
## 10 25556‚Ä¶          0 Toro‚Ä¶ Adv Adenoma   adenoma   FALSE           
## # ‚Ä¶ with 36 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div>  </div>
</div>

<hr />

<h3 id="activity-8">Activity 8</h3>
<p>Create a data frame that contains samples from individuals who have a previous or family history of colorectal cancer</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">filter</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">previous_history</span><span class="w"> </span><span class="o">|</span><span class="w"> </span><span class="n">family_history_of_crc</span><span class="p">)</span><span class="w">
</span></code></pre></div>  </div>

  <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 199 x 17
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20036‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  3 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  4 20236‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  5 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
##  6 20296‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  7 20336‚Ä¶          0 Toro‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
##  8 20416‚Ä¶          0 U Mi‚Ä¶ Adenoma       adenoma   FALSE           
##  9 20436‚Ä¶          5 Toro‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
## 10 20456‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
## # ‚Ä¶ with 189 more rows, and 11 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;
</code></pre></div>  </div>
</div>

<hr />

<h2 id="selecting-and-filtering-with-pipes">Selecting and filtering with pipes</h2>

<p>Let‚Äôs leverage the <code class="language-plaintext highlighter-rouge">select</code> and <code class="language-plaintext highlighter-rouge">filter</code> commands we have been using to work with a new <code class="language-plaintext highlighter-rouge">tsv</code> file. The file <code class="language-plaintext highlighter-rouge">raw_data/baxter.groups.ave-std.summary</code> was generated by the <a href="https://mothur.org/wiki/Summary.single">mothur <code class="language-plaintext highlighter-rouge">summary.single</code></a> command, which rarefies the number of sequences per sample and calculates a variety of alpha diversity metrics.</p>

<hr />

<h3 id="activity-9">Activity 9</h3>
<p>This file has a number of columns that aren‚Äôt that interesting for us. You will also find that the <code class="language-plaintext highlighter-rouge">method</code> column has two values - ave and std - which indicate the average value of the alpha diversity metric after rarefying and the standard deviation (i.e. std), which is the standard deviation for the rarefaction replicates. You have several tasks‚Ä¶</p>

<ul>
  <li>Write the code needed to read in the file to a new data frame called <code class="language-plaintext highlighter-rouge">alpha</code>. Make sure that the group column is read in as characters</li>
  <li>Filter out the rows that contain the standard deviation data</li>
  <li>Select the columns that contain the subject identifier, the number of observed OTUs (i.e ‚Äúsobs‚Äù), the Shannon diversity index (i.e. ‚Äúshannon‚Äù), the inverse Simpson diversity index (i.e. ‚Äúinvsimpson‚Äù), and Good‚Äôs coverage (i.e. ‚Äúcoverage‚Äù)</li>
  <li>Use the appropriate join function to create a data frame called <code class="language-plaintext highlighter-rouge">meta_alpha</code> that is a join between <code class="language-plaintext highlighter-rouge">metadata</code> and <code class="language-plaintext highlighter-rouge">alpha</code></li>
</ul>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.groups.ave-std.summary"</span><span class="p">,</span><span class="w"> </span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_character</span><span class="p">()))</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">filter</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">method</span><span class="o">==</span><span class="s1">'ave'</span><span class="p">)</span><span class="w">
</span><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">select</span><span class="p">(</span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sobs</span><span class="p">,</span><span class="w"> </span><span class="n">shannon</span><span class="p">,</span><span class="w"> </span><span class="n">invsimpson</span><span class="p">,</span><span class="w"> </span><span class="n">coverage</span><span class="p">)</span><span class="w">
</span><span class="n">meta_alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">inner_join</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">alpha</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sample"</span><span class="o">=</span><span class="s2">"group"</span><span class="p">))</span><span class="w">
</span></code></pre></div>  </div>
</div>

<hr />

<p>Hopefully that was a good review of what we‚Äôve done in this and the previous lessons. The approach we‚Äôve taken to generate <code class="language-plaintext highlighter-rouge">meta_alpha</code> works perfectly. I‚Äôd like to show you a different way to think about the code. If you look at these four lines of code, you should see that the data kind of ‚Äúflows‚Äù from the <code class="language-plaintext highlighter-rouge">tsv</code> file to the final version of <code class="language-plaintext highlighter-rouge">alpha</code> before we join it to <code class="language-plaintext highlighter-rouge">metadata</code>. There‚Äôs a package installed with <code class="language-plaintext highlighter-rouge">dplyr</code> called <code class="language-plaintext highlighter-rouge">magrittr</code> that has a funny looking function called a pipe - <code class="language-plaintext highlighter-rouge">%&gt;%</code>. The pipe, directs the flow of data from one command to the next. Instead of writing over <code class="language-plaintext highlighter-rouge">alpha</code> multiple times, we can write it once as the output of the data flow through the pipes.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.groups.ave-std.summary"</span><span class="p">,</span><span class="w"> </span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_character</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">method</span><span class="o">==</span><span class="s1">'ave'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">select</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sobs</span><span class="p">,</span><span class="w"> </span><span class="n">shannon</span><span class="p">,</span><span class="w"> </span><span class="n">invsimpson</span><span class="p">,</span><span class="w"> </span><span class="n">coverage</span><span class="p">)</span><span class="w">
</span><span class="n">alpha</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 5
##    group    sobs shannon invsimpson coverage
##    &lt;chr&gt;   &lt;dbl&gt;   &lt;dbl&gt;      &lt;dbl&gt;    &lt;dbl&gt;
##  1 2003650  262.    4.02       35.6    0.991
##  2 2005650  292.    3.98       26.6    0.990
##  3 2007660  283.    3.91       26.7    0.992
##  4 2009650  324.    4.16       30.1    0.991
##  5 2013660  133.    3.33       17.4    0.997
##  6 2015650  233.    3.74       20.8    0.993
##  7 2017660  238.    3.98       28.6    0.994
##  8 2019651  191.    3.69       20.1    0.996
##  9 2023680  300.    4.01       28.9    0.992
## 10 2025653  179.    3.39       14.5    0.995
## # ‚Ä¶ with 480 more rows
</code></pre></div></div>

<p>Viola! Cool, eh? You may not see the benefit of the pipes here, but in subsequent lessons we will pipe together numerous functions to direct the flow of data. Instead of writing over <code class="language-plaintext highlighter-rouge">alpha</code> as we did in the previous code chunks, some people would rather write each update to a new variable name. Both approaches get tedious and so the ability to pipe becomes pretty handy. In fact, we can skip the creation of the <code class="language-plaintext highlighter-rouge">alpha</code> data frame all together by piping this flow right into the <code class="language-plaintext highlighter-rouge">inner_join</code> function call. Notice that in the code below, the <code class="language-plaintext highlighter-rouge">inner_join</code> function call has a <code class="language-plaintext highlighter-rouge">.</code> where <code class="language-plaintext highlighter-rouge">alpha</code> had been before. The <code class="language-plaintext highlighter-rouge">.</code> tells <code class="language-plaintext highlighter-rouge">inner_join</code> to use the data that is flowing through the pipe.</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">meta_alpha</span><span class="w"> </span><span class="o">&lt;-</span><span class="w"> </span><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.groups.ave-std.summary"</span><span class="p">,</span><span class="w"> </span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_character</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">method</span><span class="o">==</span><span class="s1">'ave'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">select</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sobs</span><span class="p">,</span><span class="w"> </span><span class="n">shannon</span><span class="p">,</span><span class="w"> </span><span class="n">invsimpson</span><span class="p">,</span><span class="w"> </span><span class="n">coverage</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">inner_join</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sample"</span><span class="o">=</span><span class="s2">"group"</span><span class="p">))</span><span class="w">
</span><span class="n">meta_alpha</span><span class="w">
</span></code></pre></div></div>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>## # A tibble: 490 x 21
##    sample fit_result site  diagnosis_bin diagnosis previous_history
##    &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;         &lt;fct&gt;     &lt;lgl&gt;           
##  1 20036‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  2 20056‚Ä¶          0 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  3 20076‚Ä¶         26 U Mi‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  4 20096‚Ä¶         10 Toro‚Ä¶ Adenoma       adenoma   FALSE           
##  5 20136‚Ä¶          0 U Mi‚Ä¶ Normal        normal    FALSE           
##  6 20156‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    FALSE           
##  7 20176‚Ä¶          7 Dana‚Ä¶ Cancer        cancer    TRUE            
##  8 20196‚Ä¶         19 U Mi‚Ä¶ Normal        normal    FALSE           
##  9 20236‚Ä¶          0 Dana‚Ä¶ High Risk No‚Ä¶ normal    TRUE            
## 10 20256‚Ä¶       1509 U Mi‚Ä¶ Cancer        cancer    TRUE            
## # ‚Ä¶ with 480 more rows, and 15 more variables: history_of_polyps &lt;lgl&gt;,
## #   age &lt;dbl&gt;, sex &lt;chr&gt;, smoke &lt;lgl&gt;, diabetic &lt;lgl&gt;,
## #   family_history_of_crc &lt;lgl&gt;, height &lt;dbl&gt;, weight &lt;dbl&gt;, nsaid &lt;lgl&gt;,
## #   diabetes_med &lt;lgl&gt;, stage &lt;chr&gt;, sobs &lt;dbl&gt;, shannon &lt;dbl&gt;,
## #   invsimpson &lt;dbl&gt;, coverage &lt;dbl&gt;
</code></pre></div></div>

<p>But wait‚Ä¶ there‚Äôs more!</p>

<div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.groups.ave-std.summary"</span><span class="p">,</span><span class="w"> </span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">col_character</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">filter</span><span class="p">(</span><span class="n">method</span><span class="o">==</span><span class="s1">'ave'</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">select</span><span class="p">(</span><span class="n">group</span><span class="p">,</span><span class="w"> </span><span class="n">sobs</span><span class="p">,</span><span class="w"> </span><span class="n">shannon</span><span class="p">,</span><span class="w"> </span><span class="n">invsimpson</span><span class="p">,</span><span class="w"> </span><span class="n">coverage</span><span class="p">)</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">inner_join</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"sample"</span><span class="o">=</span><span class="s2">"group"</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">age</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">shannon</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">diagnosis</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">coord_cartesian</span><span class="p">(</span><span class="n">xlim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">90</span><span class="p">),</span><span class="w"> </span><span class="n">ylim</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="m">0</span><span class="p">,</span><span class="m">5</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
			</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w">
			</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">),</span><span class="w">
			</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cancer"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"Relationship between community diversity and subject's age"</span><span class="p">,</span><span class="w">
			</span><span class="n">x</span><span class="o">=</span><span class="s2">"Age"</span><span class="p">,</span><span class="w">
			</span><span class="n">y</span><span class="o">=</span><span class="s2">"Shannon Diversity Index"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div></div>

<p><img src="assets/images/04_combining_data_frames//unnamed-chunk-36-1.png" title="plot of chunk unnamed-chunk-36" alt="plot of chunk unnamed-chunk-36" width="504" /></p>

<p>We‚Äôve gone all the way - reading in the data from a <code class="language-plaintext highlighter-rouge">tsv</code> file to getting the rows and columns we want to joining it with our metadata to plotting. All in one command. Pretty slick.</p>

<hr />

<h3 id="activity-10">Activity 10</h3>
<p>With our new found piping skillz, rewrite the code from the end of the last tutorial to generate the ordination. Use the <code class="language-plaintext highlighter-rouge">metadata</code> data frame that we‚Äôve already been working with</p>

<p><input type="button" class="hideshow" /></p>
<div style="display:none;">

  <div class="language-r highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">read_tsv</span><span class="p">(</span><span class="n">file</span><span class="o">=</span><span class="s2">"raw_data/baxter.braycurtis.pcoa.axes"</span><span class="p">,</span><span class="w"> </span><span class="n">col_types</span><span class="o">=</span><span class="n">cols</span><span class="p">(</span><span class="n">group</span><span class="o">=</span><span class="n">col_character</span><span class="p">()))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">inner_join</span><span class="p">(</span><span class="n">metadata</span><span class="p">,</span><span class="w"> </span><span class="n">.</span><span class="p">,</span><span class="w"> </span><span class="n">by</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s1">'sample'</span><span class="o">=</span><span class="s1">'group'</span><span class="p">))</span><span class="w"> </span><span class="o">%&gt;%</span><span class="w">
	</span><span class="n">ggplot</span><span class="p">(</span><span class="n">aes</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">axis1</span><span class="p">,</span><span class="w"> </span><span class="n">y</span><span class="o">=</span><span class="n">axis2</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">diagnosis</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">geom_point</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="m">19</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="o">=</span><span class="m">2</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">scale_color_manual</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="kc">NULL</span><span class="p">,</span><span class="w">
			</span><span class="n">values</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"black"</span><span class="p">,</span><span class="w"> </span><span class="s2">"blue"</span><span class="p">,</span><span class="w"> </span><span class="s2">"red"</span><span class="p">),</span><span class="w">
			</span><span class="n">breaks</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"cancer"</span><span class="p">),</span><span class="w">
			</span><span class="n">labels</span><span class="o">=</span><span class="nf">c</span><span class="p">(</span><span class="s2">"Normal"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Adenoma"</span><span class="p">,</span><span class="w"> </span><span class="s2">"Cancer"</span><span class="p">))</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">coord_fixed</span><span class="p">()</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">labs</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">"PCoA of Bray-Curtis Distances Between Stool Samples"</span><span class="p">,</span><span class="w">
			</span><span class="n">x</span><span class="o">=</span><span class="s2">"PCo Axis 1"</span><span class="p">,</span><span class="w">
			</span><span class="n">y</span><span class="o">=</span><span class="s2">"PCo Axis 2"</span><span class="p">)</span><span class="w"> </span><span class="o">+</span><span class="w">
		</span><span class="n">theme_classic</span><span class="p">()</span><span class="w">
</span></code></pre></div>  </div>

  <p><img src="assets/images/04_combining_data_frames//unnamed-chunk-37-1.png" title="plot of chunk unnamed-chunk-37" alt="plot of chunk unnamed-chunk-37" width="504" /></p>
</div>

<hr />

<h2 id="conclusion">Conclusion</h2>
<p>A couple of closing thoughts are needed before we move on to the next lesson where we‚Äôll start doing more sophisticated work with data frames and functions from the <code class="language-plaintext highlighter-rouge">dplyr</code> package. First, you might ask why we ran select and filter on alpha rather than on the output of the <code class="language-plaintext highlighter-rouge">inner_join</code>. There‚Äôs no real reason. The output would be the same. Do what makes sense for where you are in your analysis. Second, you can feel free to break up the piping as much as you want. It is there as a helper to your coding so that you don‚Äôt have to create temporary data frames or write over ones you just made. Beyond these advantages, most people find that debugging code that uses the pipes is much easier than with the other approaches. Finally, instead of making the alpha diversity scatter plot one pipeline, I probably would normally break it up into two pipelines. One pipeline to create <code class="language-plaintext highlighter-rouge">alpha</code> and do the <code class="language-plaintext highlighter-rouge">select</code> and <code class="language-plaintext highlighter-rouge">filter</code> steps. The second would join <code class="language-plaintext highlighter-rouge">alpha</code> with <code class="language-plaintext highlighter-rouge">metadata</code> and produce the plot.</p>
:ET